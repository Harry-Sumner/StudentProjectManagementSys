@page
@model Project_Management_System.Pages.Submit_ProposalModel
@{
}

@inject SignInManager<SPMS_User> SignInManager
@inject UserManager<SPMS_Student> StudentManager
@inject UserManager<SPMS_Staff> StaffManager

@using Microsoft.AspNetCore.Identity
@using Project_Management_System.Data

<link rel="stylesheet" href="~/css/submitProposals.css">
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<script src="~/js/proposalDragDrop.js"></script>

@{
    var student = await StudentManager.GetUserAsync(User);
    
}

<div class="body--submitLevel6--container">
    <div class="body--submitLevel6--title">
        <span>Dissertation Project Preferences</span>
    </div>

    <ul class="body--submitLevel6--studentDetails">
        <li>Student Name: @student.Name</li>
        <li>Student Number: @student.StudentNo</li>
        @foreach (var course in Model.Course.Where(i => i.CourseID == student.CourseID))
        {
            <li>Degree Programme: @course.CourseName</li>
        }
        
    </ul>
    
    @if(Model.TopicBasket.Count() == 0)
    {
        <ul class="body--submitLevel6--studentDetails">
            <li>You have not added any topics.</li>
        </ul>
        
    }
    else
    {
        <form method="post" action="">
            <div class="confirmDetailsContianer">
                <input type="checkbox" class="detailsCorrect" name="confirmDetails">
                <label for="confirmDetails">I confirm that these Details are correct,</label>
                <label class="incorrectDetails" for="confirmDetails">
                    My details are incorrect
                    <div class="additionalInfo">
                        <span>Please contact your PAT or your head of department immediately if your details are incorrect</span>
                    </div>
                </label>

            </div>

            <span class="proposalsTitle">Please order your three preferred project Topics with #1 being your <b>Top</b> Preference</span>
            <ul class="proposalsPriority">
                @foreach (var proposal in Model.TopicBasket)
                {
                    @foreach (var topic in Model.Topics.Where(i => i.TopicID == proposal.TopicID))
                    {
                        Model.Priority += 1;
                        <li class="proposalBox" draggable="true" id="propsal1">
                            <span class="proposalID">@Model.Priority</span>
                            <div class="proposalDivider"></div>
                            <h1>@topic.TopicName</h1>
                            @if(topic.SupervisorID != null)
                            {
                                var staff = await StaffManager.FindByIdAsync(topic.SupervisorID);
                                <h1>@staff.Name</h1>
                            }
                        </li>

                    }
                }

                @*    <li class="proposalBox" draggable="true" id="propsal2">
            <span class="proposalID">2</span>
            <div class="proposalDivider"></div>
            <h1>Example Proposal</h1>
            <h1>Example Supervisor</h1>
            </li>
            <li class="proposalBox" draggable="true" id="propsal3">
            <span class="proposalID">3</span>
            <div class="proposalDivider"></div>
            <h1>Example Proposal</h1>
            <h1>Example Supervisor</h1>
            </li> *@
            </ul>
            <div class="informationIconContainer">
                <div class="informationIcon">!</div>
                <span>Drag and Drop the proposals to order them</span>
            </div>

            <button type="submit" class="submitProposal">Submit</button>
        </form>
    }
</div>


